function [gData] = create_global(prgram)

[DecNef_Project, DecNef_ReleaseData] = release_info();

% receiver ID
% receiver_id = 0 : neurofeedback which means the collector instance.
% receiver_id > 0 : receiver ID
switch lower(prgram)
  case 'neurofeedback',	receiver_id = 0;	
  case 'receiver',	receiver_id = 1;
  otherwise,		error('Unknown program name(''%s'').', prgram);
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% initialise the global structure gData.
% This is probably the most important variable of this program as it
% will store all the relevant information to process the data and display
% the experiment. 
% Konstantin "Kostya" Demin: added project_folder as global variable along
% to improve transportability of the script
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

gData = struct(...
    'version', [],...			
    'define', [],...			
    'file_dialog', [],...		
    'para', [],...			
    'data', [],...		
    'dot', []...
    );

% These functions are defined below.
% They will initialised multiple variables.
gData.version =create_version(DecNef_Project, DecNef_ReleaseData, receiver_id);
gData.define = create_define(DecNef_Project);
% This here is an external function. To load default values.
gData.define = load_default_value(gData.define, pwd);
gData.para = create_para(gData.define);
gData.data = create_data();
gData.dot = create_dot();

try
  rand('state', sum(100*clock));
  rng(round(sum(100*clock)), 'twister');
catch
  dt = clock;
  s = normrnd(gData.para.score.normrnd_mu,gData.para.score.normrnd_sigma,round(sum(dt(1:3))), round(sum(dt(4:6))));
  rand('state', sum(s(:))); 
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End of 'function create_global()' %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function [version] = create_version(Project, ReleaseData, receiver_id)
% this will create gData.version. There are 3 subsections:
% DecNef, matlab and SPM

% First, the DecNef version section:
% write down a few information regarding the project name, release date of
% the code: experiment date and experiment time, as well as the receiver
% ID.
t = now;
exp_date = str2num( datestr(t, 'yyyymmdd') );
exp_time = str2num( datestr(t, 'HHMMSS') );
decnef = struct(...
    'project', Project,...	
    'release', ReleaseData,...	
    'exp_date', exp_date,...   
    'exp_time', exp_time,...    
    'receiver_id', receiver_id... 
    );

% Now the Matlab version section:
mat = ver('MATLAB');
if ( strcmp(mat.Release(1), '(') && strcmp(mat.Release(end), ')') ) ||...
      ( strcmp(mat.Release(1), '[') && strcmp(mat.Release(end), ']') )
  mat.Release(end) = '';
  mat.Release(1) = '';
end
matlab_ = struct(...
    'version', mat.Version,...	
    'release', mat.Release...
    );

% and the SPM version section:
[v, r] = spm('Ver','');
spm_ = struct(...
    'version', v,...			
    'release', str2num(r)...	
    );

% Put everything together:
version = struct(...
    'decnef', decnef,...	
    'matlab', matlab_,...	
    'spm', spm_...		
    );

function [define] = create_define(Project)
% This is to create the define substection.
% It includes parameters for handling the data.

% first subsection is default:
default = struct(...
    'RECEIVER_NUM', 2,...		% default to 2 receivers (this will be overwritten by the GUI anyway).
    'CURRENT_BLOCK', 5,...		% It assumes that the 5 run of the scanner is the first one to use. Usually the first few runs are aligners, strcutural,...
    'QUIT_KEY_INUM', 3,...		
    'REALIGN_VAL_NUM', 6,...		% Realignment parameter
    'SSS_MAX_LEVEL', 7,...		% This was for the sleepiness scale (no longer used)
    'NG_SCORE_DISPLAY_TIME', 0.2,...	
    'CAUTION_MSG_DELAY_SCAN_NUM', 10,...
    'DEFUALT_SET_FNAME', '',...		% default file
    'CACHE_FNAME', 'cache.txt'...	% Cache file 
    );
% This will define the location of the default_set.txt file in a hidden folder
% .default_set. This file will be imported using gData.define =
% load_default_value(gData.define, pwd); (on line 35)
default.DEFUALT_SET_FNAME = fullfile('.default_set', 'default_set.txt');
default.DEFUALT_SET_FNAME = fullfile('.default_set', 'default_set.txt');

% Next setion is denoising_method:
% Two possible detrending methods:
denoising_method = struct(...
    'REGRESS', 1,...	
    'DETREND', 2 ...
    );
% Next setion is define.files:
% This defines many parameters with respect to the motion parameters, and
% the files to write down the results at the end of the experiment.
ascii = sprintf('_DecNef%02d.txt', Project);
binary = sprintf('_DecNef%02d.nfb', Project);
nonzero = 'NONZERO_ELEMENTS';
files = struct(...
    'REALIG_PARA_FNAME_PREFIX_CODE', 'rp_',...% Realignment para file
    'PARA_DIR',fullfile('..','PARA'),...% Parameter file directory
    'PARA_FILE_EXTENSION', '.txt',...	% Parameter file
    'SHAM_SCORE_FILE_EXTENSION', '.txt',... % Sham score file
    'ASCII_DATA_EXTENSION', ascii,...	% ASCII
    'BINARY_DATA_EXTENSION', binary,...	% BINARY
    'ROI_FILE_EXTENSION', [],...	% ROI file
    'NONZERO_ELEMENT_THRESHOLD', nonzero,...
    'ROI_EPI_THRESHOLD', 100.0,...	% ROI EPI data
    'ROI_THRESHOLD', nonzero,...	% ROI,WM,GS,CSF data
    'DICOM_FILE_EXTENSION', '.dcm',...	% DICOM file
    'NIFTI_FILE_EXTENSION', [],...	% NIfTI file
    'CLEANUP_WORK_FILES', true,...	
    'STD_DIALOG_BOX', false...		% dialog box
    );
files.NIFTI_FILE_EXTENSION = { '.nii' , '.img', '.hdr' }; % NIfTI file
files.ROI_FILE_EXTENSION ={ '.txt' , files.NIFTI_FILE_EXTENSION{:} };	% ROI file

% This is important: it defines the condition associated with each TRs.
% The display_exp instance will use this to set the display.
% Also, the collector instance will use this information to start computing the
% feedback for instance.

condition = struct(...
    'IDLING', 0,...		
    'PRE_TRIAL', 1,...		
    'PREP_REST1', 2,...		
    'PREP_REST2', 3,...		
    'REST', 4,...		
    'TEST', 5,...		
    'DELAY', 6,...		
    'CALC_SCORE', 7,...		
    'FEEDBACK_SCORE', 8,...	
    'FINISH', 9 ...		
    );


% This is to set the way neurofeedback is going to be displayed.
% Calc score will used the computed score in real-time.
score_mode = struct(...
    'CALC_SCORE', 1,...		
    'SHAM_RAND_SCORE', 2,...	
    'SHAM_SCORE_FILE', 3 ...	
    );

% This will initalized multiple parameters for the display of the visual
% feedback.
feedback = struct(...
    'io_tool', [],...		
    'feedback_type', [],...	
    'feedback_score_timing',[],...
    'color', [],...		
    'offset_ptb', [],...	%ptb : psychophysics toolbox
    'offset_mat', [],...	% 
    'FONT_NAME', 'Courier New',... 
    'FONT_SIZE', 100,...		% This value is actually set by the file experiment/.default_set/default_set.txt
    'INITIALIZE', 0,...		
    'GAZE', 1,...		
    'PREP_REST1', 2,...		
    'PREP_REST2', 3,...		
    'REST', 4,...		
    'TEST', 5,...		
    'PREP_SCORE', 6,...		
    'SCORE', 7,...		
    'NG_SCORE', 8,...		
    'SLEEP_CHECK', 9,...	
    'FINISHED_BLOCK', 10,...	
    'FINISH', 11 ...		
    );

feedback.io_tool = struct(...
    'DO_NOT_USE', 0,...			% no feedback
    'PSYCHTOOLBOX', 1,...		% Psychtoolbox
    'MATLAB', 2 ...			% MATLAB
    );

feedback.feedback_type = struct(...
    'TEXT_MODE', 0,...			
    'CIRCLE_MODE', 1 ...		
    );

feedback.feedback_score_timing = struct(...
    'FEEDBK_SCAN', 0,...        
    'RIGHT_AWAY', 1 ...         
    );

feedback.color = struct(...
    'BG', [170, 170, 170],...		
    'TEXT', [0, 0, 0],...		
    'GAZE', [255, 255, 255],...		
    'SCORE_CIRCLE', [34, 139, 34],...	
    'SCORE_CIRCLE_PLUS', [34, 139, 34],... 
    'SCORE_CIRCLE_MINUS', [139, 34, 34],...
    'MAX_SCORE_FRAME', [34, 139, 34],...
    'HALF_SCORE_FRAME', [34, 139, 34]...
    );

offset = struct(...
    'condition_comment', [0, 70],...	
    'finished_comment', [0, 120],...	
    'score_text', [0, -10],...		
    'gaze', [0, 0],...			
    'score_corcle', [0, 0] ...		
    );
feedback.offset_ptb = offset;	% Psychtoolbox
feedback.offset_mat = offset;	% MATLAB


% default values for the msocket function
msocket = struct(...
    'MSOCKET_PORT', 3000,...		% TCP/IP port”Ô?† (default’l)
    'TIMEOUT', 0.01,...			% timeoutŽžŠÔ (sec)
    'SERVER_NAME', 'MRI-RT',...	% msocket server‚(could be either MRI-RT or MRI-STIM)
    'INITIALIZE_SERVER', 0,...		% msocket (Server)
    'INITIALIZE_CLIENT', 1,...		% msocket (Client)
    'SEND_DATA', 2,...			
    'RECEIVE_DATA', 3,...	
    'INITIALIZE_SERVER_DISP', 4,...		% msocket (Server)
    'INITIALIZE_CLIENT_DISP', 5,...		% msocket (Client)
    'SEND_DATA_DISP', 6,...			
    'RECEIVE_DATA_DISP', 7,...
    'FINISH', 8 ...			
    );

command = struct(...
    'SCAN_START', 1,...			
    'QUIT', 2,...			
    'FINISH', 3 ...			
    );

key = struct(...
    'QUIT_KEY', 'ESCAPE',...	
    'FMRI_TRIGGER_KEY', 't',...	% Trigger from the scanner to initiate the display
    'SLEEP_CHECK_KEY', 'b' ...	% This is to check if the participants are asleep. (not currently used).
    );

% information for the GUI
gui = struct(...
    'window_color', [1.0, 0.95, 1.0],...	% window‚Ìcolor
    'bgcol_panel', [1.0, 0.85, 0.85],...	% panel‚Ìbackground
    'fgcol_panel', [0.0, 0.0, 0.3],...		% panel‚Ìforeground
    'fgcol_title', [1.0, 0.0, 0.0],...		% title‚Ìforeground
    'fgcol_text', [0.0, 0.0, 0.0],...		% static text‚Ìforeground
    'bgcol_edit', [1.0, 1.0, 1.0],...		% edit text‚Ìbackground
    'fgcol_edit', [0.0, 0.0, 0.0],...		% edit text‚Ìforeground
    'bgcol_push', [0.6, 0.6, 0.75],...		% push button‚Ìbackground
    'fgcol_push', [0.0, 0.0, 0.3],...		% push button‚Ìforeground
    'active_push', [1.0, 0.0, 0.0],...		% push button‚Ìforeground
    'bgcol_popup', [1.0, 1.0, 1.0],...		% pop-up menu‚Ìbackground
    'fgcol_popup', [0.0, 0.0, 0.0],...		% pop-up menu‚Ìforeground
    'bgcol_listbox', [1.0, 1.0, 1.0],...	% list box‚Ìbackground
    'fgcol_listbox', [0.0, 0.0, 0.0],...	% list box‚Ìforeground
    'bgcol_radio', [1.0, 0.85, 0.85],...	% radio button‚Ìbackground
    'fgcol_radio', [0.0, 0.0, 0.0],...		% radio button‚Ìforeground
    'enable', [0.0, 0.8, 0.0],...		
    'disabel', [0.8, 0.8, 0.8],...		
    'select', [0.8, 0.8, 0.0]...		
    );

% Put the define section together:
define = struct(...
    'DECNEF_PROJECT', Project,...	
    'default', default,...		
    'denoising_method', denoising_method,...
    'files', files,...			% File/Directory
    'scan_condition', condition,...	
    'score_mode', score_mode,...	
    'feedback', feedback,...		
    'msocket', msocket,...		
    'command', command,...		
    'key', key,...			
    'gui', gui,...			
    'MIN', 1,...			
    'MAX', 2 ...			
    );
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End of 'function create_define()' %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


function [para] = create_para(define)
% Defines a number of parameters
files = struct(...
    'current_dir', '',...	% Current directory
    'data_top_dir', '',...	% Data top directory
    'roi_top_dir', '',...	% ROI top directory
    'para_dir', '',...		% Parameter file‚Ìdirectory
    'sham_score_dir', '',...	% Sham score file‚Ìdirectory (*6)
    'save_dir', '',...		% Data store directory
    'work_dir', '',...		% Work directory (*1)
    'roi_dir', '',...		% ROI file‚Ìdirectory
    'dicom_dir', '',...		% DICOM file‚Ìdirectory (*2)
    'templ_image_dir', '',...	% Template image file‚Ìdirectory (*2)
    'para_fname', '',...	% Parameter file
    'sham_score_fname', '',...	% Sham score file (*6)
    'roi_epi_threshold', 100.0,... % ROI EPI data‚Ìè‡’l (*3)
    'roi_fnum', 0,...		% ROI file‚Ì?” (*4)
    'roi_fname', '',...		% ROI file (*4) (*5)
    'roi_threshold', [],...	% ROI data‚Ìè‡’l (*3)
    'wm_fname', '',...					% WM file (*8)
    'wm_threshold', define.files.ROI_THRESHOLD,...	% WM data‚Ìè‡’l (*3)
    'gs_fname', '',...					% GS file (*8)
    'gs_threshold', define.files.ROI_THRESHOLD,...	% GS data‚Ìè‡’l (*3)
    'csf_fname', '',...					% CSF file (*8)
    'csf_threshold', define.files.ROI_THRESHOLD,...	% CSF data‚Ìè‡’l (*3)
    'templ_image_fname', '',...	% Template image file (*7)
    'templ_nifti_fname', '',...	% Template NIfTI file (*1)
    'MNI_trans_fname', '',...	% Template MNI transformation file (*1)(VTD:edit)
    'nifti_fnames', [],...	% Šescan‚ÌNIfTI file
    'dicom_fnameB', ''...	% DICOM file‚Ìfile–¼‚Ì‘O”¼•”
    );
files.current_dir = pwd;		% Current directory
files.para_dir = define.files.PARA_DIR;	% Parameter file
files.roi_epi_threshold = define.files.ROI_EPI_THRESHOLD;
files.roi_fname = {};			% ROI file
files.roi_threshold = {};		% ROI data

scans = struct(...
    'trial_num', 1,...			% This is the number of NF trials.
    'pre_trial_scan_num', 1,...		% Number of scans before the feedback in each trial.
    'prep_rest1_scan_num', 1,...	% Number of scans for rest 1
    'prep_rest2_scan_num', 0,...	% Numbr of scans for rest 2
    'rest_scan_num', 1,...		
    'test_scan_num', 1,...		
    'pre_test_delay_scan_num', 1,...	
    'post_test_delay_scan_num', 1,...	
    'calc_score_scan_num', 1,...	% Number of scans during the calculation period
    'feedbk_score_scan_num', 1,...	% Number of scans during the feedback period
    'TR', 2,...				% in seconds
    'regress_scan_num', 20,...		% This is the number of scans to use as baseline correction.
    'sleep_check_trial_num', 0,...	% this is to set the sleep check trial.
    'first_trial_scan_num', 0,...	% This is where the first trial begins
    'trial_scan_num', 0,...		
    'total_scan_num', 0,...		% total number of scans to expect.
    'sleep_check_trial', [],...		% here no sleep check trials.
    'calc_score_scan', [],...		% This is to indicate where to start computing the feedback.
    'score_target_scans', [] ...	% This is to define the window to use in order to compute the feedback.
    );

% score section:
score = struct(...
    'score_mode', 0,...		% “¾“_ƒ‚?[ƒh (*1)
    'radius_of_brain', 50.0,...	% in mm. I assume this is for scrubbing in FC neurofeedback.
    'FD_threshold', 0.5,...	% in mm. Also, assumes this is for scrubbing in FC.
    'corr_roi_template_threshold', 0,...% The correlation with the template will be computed in real-time. set the threshold of acceptable correlations.
    'normrnd_mu', 50.0,...	
    'normrnd_sigma', 30.3,...	
    'sham_score', [],...	
    'score_limit', [0,100]...	% score limits
    );

% score mode to use:
score.score_mode =define.score_mode.CALC_SCORE;

feedback = struct(...
    'io_tool', 0,...		
    'feedback_type', 0,...	
    'screen', 1,...		% This  is the screen where to present the visual diplay.
    'feedback_score_timing',0,...
    'prep_rest1_comment', '',...
    'prep_rest2_comment', '',...
    'rest_comment', '',...	
    'test_comment', '',...	
    'prep_score_comment', '',...
    'score_comment', '',...	
    'ng_score_comment', 'NaN',...
    'finished_block_comment', '',... 
    'finished_block_duration', 6.0,...
    'gaze_frame_r', 1,...	
    'gaze_fill_r', 1,...	
    'sleep_fill_r', 1,...	
    'max_score_r', 100,...	
    'original_debuglevel', 0,...% Original preference value (Debug level)
    'original_warnlebel', 0 ...	% Original preference value (Warning lebel)
    );


feedback.io_tool = define.feedback.io_tool.MATLAB;	% MATLAB

feedback.feedback_type = define.feedback.feedback_type.CIRCLE_MODE;

feedback.feedback_score_timing =...
    define.feedback.feedback_score_timing.FEEDBK_SCAN;

% Stanford sleepiness scale:
sss = struct(...
    'sss_flag', false,...	
    'sss_image_dir', '',...	
    'sss_image_fname', ''...
    );

% information about the DICOMs to expect.
dicom_info = struct(...
    'patient_name', '',...	
    'patient_id', '',...	
    'study_date', '',...	%(YYMMDD)
    'institution_name', '' ...	
    );

% (msocket)
msocket = struct(...
    'port', define.msocket.MSOCKET_PORT,...	% TCP/IP port
    'sock', 0,...				% msocket ID
    'port_Disp', 0,...
    'sock_Disp', 0,...
    'server_name', define.msocket.SERVER_NAME...% msocket server‚
    );



% spm_reslice()
reslice_flags = spm_get_defaults('realign.write');
reslice_flags.interp = 1;	% interp : the B-spline interpolation method.
reslice_flags.mask = 1;		% 1: mask output images
reslice_flags.prefix = '';	% prefix for resliced image [default:'r']
reslice_flags.which = 1;	% 1: don't reslice the first image.
reslice_flags.mean = 0;		% 0: not write mean image
reslice_flags.wrap=[0,0,0]; %representing wrapping in each of the dimensions.(*)
% (*) 
% spm_reslice.m‚ÌƒRƒ?ƒ“ƒg‚É?A
%         wrap   - three values of either 0 or 1, representing wrapping in
%                  each of the dimensions. For fMRI, [1 1 0] would be used.
%                  For PET, it would be [0 0 0]. [default: [0 0 0]]

para = struct(...
    'receiver_num', define.default.RECEIVER_NUM,...	% receiver
    'current_block', define.default.CURRENT_BLOCK,...	% Block
    'denoising_method', 0,...	% detrend or regress (see above: denoising_method)
    'files', files,...		% File/Directory
    'scans', scans,...		% scan
    'score', score,...		
    'feedback', feedback,... 	
    'sss', sss,...		% Stanford sleepiness scale
    'roi_vol_graph_flag',false,...% ROI volume graph
    'dicom_info', dicom_info,...% DICOM
    'msocket', msocket,...	
    'spm_reslice_flags', reslice_flags,...% spm_reslice()
    'save_name', '',...		% Save name 
    'exp_id', '',...		% Exp ID
    'exp_date', ''...		% (YYMMDD)
    );

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End of 'function create_para()' %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function [data] = create_data()
% This will be usedto store the data in real-time
receiver = struct(...
    'scan', 0,...		% scan”Ô?†
    'roi_vol', [],...		% ROI data from the ROIs
    'wm_signal', [],...		% white matter (FC DecNef)
    'gs_signal', [],...		% Global sginal (FC DecNef)
    'csf_signal', [],...	% cerebrospinal fluid signal (FC DecNef)
    'realign_val', [],...	% realignment parameter
    'corr_roi_template', [],...	% correlation with the template image
    'nifti_fnames', '' ...	% NIfTI file
    );

% information for the feedback display
feedback = struct(...
    'window_id', -1,...		
    'window_width', 0,...	
    'window_height', 0,...	
    'window_center_x', 0,...	
    'window_center_y', 0,...	
    'prep_rest1_comment', '',...
    'prep_rest2_comment', '',...
    'rest_comment', '',...	
    'test_comment', '',...	
    'prep_score_comment', '',...
    'score_comment', '',...	
    'ng_score_comment', 'NaN',...
    'finished_block_comment', '',... 
    'gaze_frame', [],...	
    'gaze_fill', [],...		
    'sleep_fill', [],...	
    'max_score', [],...		
    'half_score', [],...	
    'score', [],...		
    'comment_text', [],...
    'finished_comment_text', [],...
    'score_text', [] ...
    );

% Stanford sleepiness scale
sss = struct(...
    'level', NaN,...	
    'comment', ''...	
    );

data = struct(...
    'live_flag', false,...	% is the experiment running
    'quit_key', 0,...		
    'input_keyboard', '',...	
    'scan_condition', [],...	% This is an important variable. It will contain 1 value for each TR defining the condition (see gData.define.scan_condition)
    'roi_num', 0,...		
    'roi_mask', [],...		
    'roi_vox_num', [],...	
    'roi_template', [],...	
    'roi_weight', [],...	% This must be the decoder
    'wm_mask', [],...		
    'gs_mask', [],...		
    'csf_mask', [],...		
    'roi_vol', [],...		
    'roi_denoised_vol', [],...	
    'roi_baseline_mean', [],...	
    'roi_baseline_std', [],...	
    'wm_signal', [],...		
    'gs_signal', [],...		
    'csf_signal', [],...	
    'realign_val', [],...	
    'received_scan', [],...	% boolean vector saying which volumes have been received
    'received_scan_num', 0,...	% the latest scan received
    'current_scan', 0,...	% current scan displayed
    'current_condition', 0,...	% condition of the scan ( see above)
    'current_trial', 0,...	% the number of the nf trial
    'FD', [],...		% framewise displacement
    'corr_roi_template', [],...	% correlation with template
    'ng_scan', [],...	
    'calc_score_flg', [],...	% calculate this trial
    'label', [],...		
    'source_score', [],...	source score (before transformation)
    'score', [],...		% score for neurofeedback
    'sleep_check', [],...	
    'start_time', [],...	% 
    'receiver', receiver,...	% data from the receiver
    'feedback', feedback,...	
    'sss', sss,...		
    'block_gui', [],...		
    'para_gui', [],...		
    'sss_gui', []...	
    );

% This is an addition from the ATR database.
% This is to control the display of dotmotion during the presentation.
function [dot]=create_dot()
dot = struct(...
    'numDotField', 1,...
    'coh', 999,...
    'speed', 175,...
    'dotSize', 20,...
    'dotColor',[255,255,255],...
    'maxDotsPerFrame', 50,...
    'dir', 0,...
    'apXYD',[0,0,300;],...
    'trialtype', 1,...
    'maxDotTime', 0.867,... %% This ultimately controls dot stimulus presentation time
    'keys', 'q',...
    'ppd', 50,...        %pixels per visual degree
    'monRefresh',120,...  %monitor refresh value
    'dontclear',0,...   %If set to 1, flip will not clear the framebuffer after Flip - this allows incremental
    'rseed',[],...     %random # seed, can be empty set[]
    'targets',[],... %%emptying this variable to render useless (to lazy to delete all relevant code, cc
    'xs',[],...
    'ss',[],...
    'Ls',[],...
    'loopi',[]...
    );

% DKA: Setup project_folder if it doesnt exist (it is located outside of gData)
if ~exist('project_folder', 'var')
    global project_folder;
    scriptPath = mfilename('fullpath');
    [pathToScript, ~, ~] = fileparts(scriptPath);
    project_folder = fileparts(fileparts(fileparts(fileparts(pathToScript))));
    % Declare project_folder as global
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End of 'function create_data()' %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
